
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Mario R. Melchiori">
      
      
        <link rel="canonical" href="https://mrmelchi.github.io/Python_Practico/08_Testing_debugging/01_Testing/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>01_Testing - Python Practico</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#81-pruebas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Python Practico" class="md-header__button md-logo" aria-label="Python Practico" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Practico
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              01_Testing
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Python Practico" class="md-nav__button md-logo" aria-label="Python Practico" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Python Practico
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#las-pruebas-son-geniales-la-depuracion-es-un-asco" class="md-nav__link">
    <span class="md-ellipsis">
      Las pruebas son geniales, la depuración es un asco
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#afirmaciones" class="md-nav__link">
    <span class="md-ellipsis">
      Afirmaciones
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#programacion-por-contrato" class="md-nav__link">
    <span class="md-ellipsis">
      Programación por contrato
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pruebas-en-linea" class="md-nav__link">
    <span class="md-ellipsis">
      Pruebas en línea
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modulo-unittest" class="md-nav__link">
    <span class="md-ellipsis">
      Módulo unittest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uso-de-unittest" class="md-nav__link">
    <span class="md-ellipsis">
      Uso de unittest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejecutar-unittest" class="md-nav__link">
    <span class="md-ellipsis">
      Ejecutar unittest
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comentario" class="md-nav__link">
    <span class="md-ellipsis">
      Comentario
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#herramientas-de-prueba-de-terceros" class="md-nav__link">
    <span class="md-ellipsis">
      Herramientas de prueba de terceros
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejercicios" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ejercicios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejercicio-81-escritura-de-pruebas-unitarias" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 8.1: Escritura de pruebas unitarias
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="../../Contents/">Contenido</a> | <a href="../../07_Advanced_Topics/05_Decorated_methods/">Anterior (7.5 Métodos estáticos y de clase)</a> | <a href="../02_Logging/">Próximo (8.2 Logging)</a></p>
<h1 id="81-pruebas">8.1 Pruebas</h1>
<h2 id="las-pruebas-son-geniales-la-depuracion-es-un-asco">Las pruebas son geniales, la depuración es un asco</h2>
<p>La naturaleza dinámica de Python hace que las pruebas sean de vital importancia para la mayoría de las aplicaciones. No hay ningún compilador que encuentre errores. La única forma de encontrarlos es ejecutar el código y asegurarse de probar todas sus funciones.</p>
<h2 id="afirmaciones">Afirmaciones</h2>
<p>La declaración <code>assert</code> es una verificación interna del programa. Si una expresión no es verdadera, genera una excepción <code>AssertionError</code>.</p>
<p>Sintaxis de la declaración <code>assert</code>.</p>
<pre><code class="language-python">assert &lt;expresiónn&gt; [, 'Mensaje de diagnóstico']
</code></pre>
<p>Por ejemplo.</p>
<pre><code class="language-python">assert isinstance(10, int), 'Int esperado'
</code></pre>
<p>No debería usarse para verificar la entrada del usuario (es decir, los datos ingresados en un formulario web o algo así). Su propósito es más para verificaciones internas e invariantes (condiciones que siempre deben ser verdaderas).</p>
<h2 id="programacion-por-contrato">Programación por contrato</h2>
<p>También conocida como Diseño por contrato, el uso liberal de aserciones es un enfoque para diseñar software. Prescribe que los diseñadores de software deben definir especificaciones de interfaces precisas para los componentes del software.</p>
<p>Por ejemplo, puede colocar aserciones en todas las entradas de una función.</p>
<pre><code class="language-python">def add(x, y):
    assert isinstance(x, int), 'Espera un int'
    assert isinstance(y, int), 'Espera un int'
    return x + y
</code></pre>
<p>Al verificar las entradas, se detectarán inmediatamente los invocadores que no estén usando los argumentos adecuados.</p>
<pre><code class="language-python">&gt;&gt;&gt; add(2, 3)
5
&gt;&gt;&gt; add('2', '3')
Traceback (most recent call last):
...
AssertionError: Esperado un int
&gt;&gt;&gt;
</code></pre>
<h2 id="pruebas-en-linea">Pruebas en línea</h2>
<p>Las afirmaciones también se pueden usar para pruebas simples.</p>
<pre><code class="language-python">def add(x, y):
    return x + y

assert add(2,2) == 4
</code></pre>
<p>De esta manera, está incluyendo la prueba en el mismo módulo que su código.</p>
<p><em>Beneficio: si el código está claramente dañado, los intentos de importar el módulo fallarán.</em></p>
<p>Esto no se recomienda para pruebas exhaustivas. Es más bien una "prueba de humo" básica. ¿Funciona la función en algún ejemplo? Si no, entonces algo está definitivamente dañado.</p>
<h2 id="modulo-unittest">Módulo <code>unittest</code></h2>
<p>Supongamos que tiene un código.</p>
<pre><code class="language-python"># simple.py

def add(x, y):
    return x + y
</code></pre>
<p>Ahora, supongamos que desea probarlo. Cree un archivo de prueba independiente como este.</p>
<pre><code class="language-python"># test_simple.py

import simple
import unittest
</code></pre>
<p>Luego defina una clase de prueba.</p>
<pre><code class="language-python"># test_simple.py

import simple
import unittest

# Observe que hereda de unittest.TestCase
class TestAdd(unittest.TestCase):
    ...
</code></pre>
<p>La clase de prueba debe heredar de <code>unittest.TestCase</code>.</p>
<p>En la clase de prueba, se definen los métodos de prueba.</p>
<pre><code class="language-python"># test_simple.py

import simple
import unittest

# Observe que hereda de unittest.TestCase
class TestAdd(unittest.TestCase):
    def test_simple(self):
        # Prueba con argumentos enteros simples
        r = simple.add(2, 2)
        self.assertEqual(r, 5)

    def test_str(self):
        # Prueba con cadenas
        r = simple.add('hello', 'world')
        self.assertEqual(r, 'helloworld')
</code></pre>
<p>*Importante: Cada método debe comenzar con <code>test</code>.</p>
<h2 id="uso-de-unittest">Uso de <code>unittest</code></h2>
<p>Hay varias afirmaciones integradas que vienen con <code>unittest</code>. Cada una de ellas afirma algo diferente.</p>
<pre><code class="language-python"># Afirmar que expr es True
self.assertTrue(expr)

# Afirmar que x == y
self.assertEqual(x,y)

# Afirmar que x != y
self.assertNotEqual(x,y)

# Afirmar que x está cerca de y
self.assertAlmostEqual(x,y,places)

# Afirmar que callable(arg1,arg2,...) genera excepción
self.assertRaises(exc, callable, arg1, arg2, ...)
</code></pre>
<p>Esta no es una lista exhaustiva. Hay otras afirmaciones en el módulo.</p>
<h2 id="ejecutar-unittest">Ejecutar <code>unittest</code></h2>
<p>Para ejecutar las pruebas, convierta el código en un script.</p>
<pre><code class="language-python"># test_simple.py

...

if __name__ == '__main__':
    unittest.main()
</code></pre>
<p>Luego, ejecute Python en el archivo de prueba.</p>
<pre><code class="language-bash">bash % python3 test_simple.py
F.
=========================================================
FAIL: test_simple (__main__.TestAdd)
--------------------------------------------------------
Traceback (most recent call last):
File &quot;testsimple.py&quot;, line 8, in test_simple
self.assertEqual(r, 5)
AssertionError: 4 != 5
--------------------------------------------------------
Ran 2 tests in 0.000s
FAILED (failures=1)
</code></pre>
<h2 id="comentario">Comentario</h2>
<p>La realización de pruebas unitarias efectivas es un arte y puede volverse bastante complicada para aplicaciones grandes.</p>
<p>El módulo <code>unittest</code> tiene una gran cantidad de opciones relacionadas con los ejecutores de pruebas, la recopilación de resultados y otros aspectos de las pruebas. Consulta la documentación para obtener más detalles.</p>
<h2 id="herramientas-de-prueba-de-terceros">Herramientas de prueba de terceros</h2>
<p>El módulo <code>unittest</code> integrado tiene la ventaja de estar disponible en todas partes: es parte de Python. Sin embargo, muchos programadores también lo consideran bastante detallado. Una alternativa popular es <a href="https://docs.pytest.org/en/latest/">pytest</a>. Con pytest, tu archivo de prueba se simplifica a algo como lo siguiente:</p>
<pre><code class="language-python"># test_simple.py
import simple

def test_simple():
    assert simple.add(2,2) == 4

def test_str():
    assert simple.add('hello','world') == 'helloworld'
</code></pre>
<p>Para ejecutar las pruebas, simplemente escriba un comando como <code>python -m pytest</code>. Descubrirá todas las pruebas y las ejecutará.</p>
<p><code>pytest</code> es mucho más que este ejemplo, pero suele ser bastante fácil comenzar si decide probarlo.</p>
<h2 id="ejercicios">Ejercicios</h2>
<p>En este ejercicio, explorará la mecánica básica del uso del módulo <code>unittest</code> de Python.</p>
<p>En ejercicios anteriores, escribió un archivo <code>stock.py</code> que contenía una clase <code>Stock</code>. Para este ejercicio, se asumió que está usando el código escrito para <a href="../../07_Advanced_Topics/03_Returning_functions/">Ejercicio 7.9</a> que involucra propiedades tipificadas. Si, por alguna razón, eso no funciona, es posible que desee copiar la solución de <code>Soluciones/7_9</code> a su directorio de trabajo.</p>
<h3 id="ejercicio-81-escritura-de-pruebas-unitarias">Ejercicio 8.1: Escritura de pruebas unitarias</h3>
<p>En un archivo separado <code>test_stock.py</code>, escribe un conjunto de pruebas unitarias para la clase <code>Stock</code>. Para comenzar, aquí tienes un pequeño fragmento de código que prueba la creación de instancias:</p>
<pre><code class="language-python"># test_stock.py

import unittest
import stock

class TestStock(unittest.TestCase):
    def test_create(self):
        s = stock.Stock('GOOG', 100, 490.1)
        self.assertEqual(s.name, 'GOOG')
        self.assertEqual(s.shares, 100)
        self.assertEqual(s.price, 490.1)

if __name__ == '__main__':
    unittest.main()
</code></pre>
<p>Ejecuta tus pruebas unitarias. Deberías obtener un resultado similar a este:</p>
<pre><code>.
----------------------------------------------------------------------
Ran 1 tests in 0.000s

OK
</code></pre>
<p>Una vez que esté satisfecho con el funcionamiento, escriba pruebas unitarias adicionales que verifiquen lo siguiente:</p>
<ul>
<li>Asegúrese de que la propiedad <code>s.cost</code> devuelva el valor correcto (49010.0)</li>
<li>Asegúrese de que el método <code>s.sell()</code> funcione correctamente. Debería disminuir el valor de <code>s.shares</code> en consecuencia.</li>
<li>Asegúrese de que el atributo <code>s.shares</code> no se pueda configurar en un valor que no sea entero.</li>
</ul>
<p>Para la última parte, deberá verificar que se genere una excepción. Una forma sencilla de hacerlo es con un código como este:</p>
<pre><code class="language-python">class TestStock(unittest.TestCase):
    ...
    def test_bad_shares(self):
        s = stock.Stock('GOOG', 100, 490.1)
        with self.assertRaises(TypeError):
            s.shares = '100'
</code></pre>
<p><a href="../../Contents/">Contenido</a> | <a href="../../07_Advanced_Topics/05_Decorated_methods/">Anterior (7.5 Métodos estáticos y de clase)</a> | <a href="../02_Logging/">Próximo (8.2 Logging)</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>