<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Mario R. Melchiori">
        <link rel="canonical" href="https://mrmelchi.github.io/Python_Practico/02_Working_with_data/06_List_comprehension/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>06_List_comprehension - Python Practico</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Python Practico</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#26-listas-por-comprension" class="nav-link">2.6 Listas por comprensión</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#creando-nuevas-listas" class="nav-link">Creando nuevas listas</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#filtrado" class="nav-link">Filtrado</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#casos-de-uso" class="nav-link">Casos de uso</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#sintaxis-general" class="nav-link">Sintaxis general</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#digresion-historica" class="nav-link">Digresión histórica</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#ejercicios" class="nav-link">Ejercicios</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#comentario" class="nav-link">Comentario</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="../../Contents/">Contenido</a> | <a href="../05_Collections/">Anterior (2.5
Collections)</a> | <a href="../07_Objects/">Próximo (2.7
Objetos)</a></p>
<h1 id="26-listas-por-comprension">2.6 Listas por comprensión</h1>
<p>Una tarea común es procesar elementos de una lista. Esta sección
presenta las listas por comprensión, una herramienta poderosa para hacer
precisamente eso.</p>
<h2 id="creando-nuevas-listas">Creando nuevas listas</h2>
<p>Una lista por comprensión crea una nueva lista aplicando una operación a
cada elemento de una secuencia.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [1, 2, 3, 4, 5]
&gt;&gt;&gt; b = [2*x for x in a ]
&gt;&gt;&gt; b
[2, 4, 6, 8, 10]
&gt;&gt;&gt;
</code></pre>
<p>Otro ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [1, 2, 3, 4, 5]
&gt;&gt;&gt; b = [2*x for x in a ]
&gt;&gt;&gt; b
[2, 4, 6, 8, 10]
&gt;&gt;&gt;
</code></pre>
<p>La sintaxis general es:
<code>[ &lt;expresión&gt; for &lt;nombre_de_variable&gt; in &lt;secuencia&gt; ]</code>.</p>
<h2 id="filtrado">Filtrado</h2>
<p>También puedes filtrar durante la listas por comprensión.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [1, -5, 4, 2, -2, 10]
&gt;&gt;&gt; b = [2*x for x in a if x &gt; 0 ]
&gt;&gt;&gt; b
[2, 8, 4, 20]
&gt;&gt;&gt;
</code></pre>
<h2 id="casos-de-uso">Casos de uso</h2>
<p>Las listas por comprensión son muy útiles. Por ejemplo, puede recopilar
valores de un campo de diccionario específico:</p>
<pre><code class="language-python">stocknames = [s['name'] for s in stocks]
</code></pre>
<p>Puede realizar consultas similares a bases de datos en secuencias.</p>
<pre><code class="language-python">a = [s for s in stocks if s['price'] &gt; 100 and s['shares'] &gt; 50 ]
</code></pre>
<p>También puedes combinar una lista por comprensión con una reducción de
secuencia:</p>
<pre><code class="language-python">cost = sum([s['shares']*s['price'] for s in stocks])
</code></pre>
<h2 id="sintaxis-general">Sintaxis general</h2>
<pre><code class="language-code">[ &lt;expresión&gt; for &lt;nombre_de_variable&gt; in &lt;secuencia&gt; if &lt;condición&gt;]
</code></pre>
<p>lo que significa:</p>
<pre><code class="language-python">result = []
for nombre_de_variable in secuencia:
    if condición:
        result.append(expresión)
</code></pre>
<h2 id="digresion-historica">Digresión histórica</h2>
<p>Las listas por comprensión provienen de las matemáticas (notación de
construcción de conjuntos).</p>
<pre><code class="language-code">a = [ x * x for x in s if x &gt; 0 ] # Python

a = { x^2 | x ∈ s, x &gt; 0 }         # Matemática
</code></pre>
<p>También está implementado en varios otros lenguajes. Aunque la mayoría
de los programadores probablemente no estén pensando en sus clases de
matemáticas. No obstante, está bien verlo como un interesante atajo para
crear listas.</p>
<h2 id="ejercicios">Ejercicios</h2>
<p>Comience ejecutando su programa <code>report.py</code> para que tenga la Cartera de
acciones cargadas en el modo interactivo.</p>
<pre><code class="language-bash">bash % python3 -i report.py
</code></pre>
<p>Ahora, en modo interactivo de Python, escriba instrucciones para
realizar la operaciones que se describen a continuación. Estas
operaciones realizan varios tipos de reducciones de datos,
transformaciones y consultas sobre los datos de la cartera.</p>
<h3 id="ejercicio-219-comprension-de-listas">Ejercicio 2.19: Comprensión de listas</h3>
<p>Pruebe algunas listas por comprensión simples solo para familiarizarse
con la sintaxis.</p>
<pre><code class="language-python">&gt;&gt;&gt; nums = [1,2,3,4]
&gt;&gt;&gt; squares = [ x * x for x in nums ]
&gt;&gt;&gt; squares
[1, 4, 9, 16]
&gt;&gt;&gt; twice = [ 2 * x for x in nums if x &gt; 2 ]
&gt;&gt;&gt; twice
[6, 8]
&gt;&gt;&gt;
</code></pre>
<p>Observe cómo las listas por comprensión crean una nueva lista con los
datos adecuadamente transformados o filtrados.</p>
<h3 id="ejercicio-220-reducciones-de-secuencias">Ejercicio 2.20: Reducciones de secuencias</h3>
<p>Calcule el costo total de la cartera utilizando una única declaración de
Python.</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio = read_portfolio('Data/portfolio.csv')
&gt;&gt;&gt; cost = sum([ s['shares'] * s['price'] for s in portfolio ])
&gt;&gt;&gt; cost
44671.15
&gt;&gt;&gt;
</code></pre>
<p>Después de haber hecho esto, muestra cómo puedes calcular el valor
actual. de la cartera mediante un único enunciado.</p>
<pre><code class="language-python">&gt;&gt;&gt; value = sum([ s['shares'] * prices[s['name']] for s in portfolio ])
&gt;&gt;&gt; value
28686.1
&gt;&gt;&gt;
</code></pre>
<p>Ambas operaciones anteriores son un ejemplo de reducción de mapa. Las
listas por comprensión consisten en mapear una operación a lo largo de
la lista.</p>
<pre><code class="language-python">&gt;&gt;&gt; [ s['shares'] * s['price'] for s in portfolio ]
[3220.0000000000005, 4555.0, 12516.0, 10246.0, 3835.1499999999996, 3254.9999999999995, 7044.0]
&gt;&gt;&gt;
</code></pre>
<p>La función <code>sum()</code> realiza entonces una reducción en el resultado:</p>
<pre><code class="language-python">&gt;&gt;&gt; sum(_)
44671.15
&gt;&gt;&gt;
</code></pre>
<p>Con este conocimiento, ahora estás listo para lanzar una empresa
emergente de big data.</p>
<h3 id="ejercicio-221-consultas-de-datos">Ejercicio 2.21: Consultas de datos</h3>
<p>Pruebe los siguientes ejemplos de varias consultas de datos.</p>
<p>En primer lugar, una lista de todas las tenencias de cartera con más de
100 acciones.</p>
<pre><code class="language-python">&gt;&gt;&gt; more100 = [ s for s in portfolio if s['shares'] &gt; 100 ]
&gt;&gt;&gt; more100
[{'price': 83.44, 'name': 'CAT', 'shares': 150}, {'price': 51.23, 'name': 'MSFT', 'shares': 200}]
&gt;&gt;&gt;
</code></pre>
<p>Todas las tenencias de cartera de acciones de MSFT e IBM.</p>
<pre><code class="language-python">&gt;&gt;&gt; msftibm = [ s for s in portfolio if s['name'] in {'MSFT','IBM'} ]
&gt;&gt;&gt; msftibm
[{'price': 91.1, 'name': 'IBM', 'shares': 50}, {'price': 51.23, 'name': 'MSFT', 'shares': 200},
  {'price': 65.1, 'name': 'MSFT', 'shares': 50}, {'price': 70.44, 'name': 'IBM', 'shares': 100}]
&gt;&gt;&gt;
</code></pre>
<p>Una lista de todas las tenencias de acciones que cuestan más de \$10000.</p>
<pre><code class="language-python">&gt;&gt;&gt; cost10k = [ s for s in portfolio if s['shares'] * s['price'] &gt; 10000 ]
&gt;&gt;&gt; cost10k
[{'price': 83.44, 'name': 'CAT', 'shares': 150}, {'price': 51.23, 'name': 'MSFT', 'shares': 200}]
&gt;&gt;&gt;
</code></pre>
<h3 id="ejercicio-222-extraccion-de-datos">Ejercicio 2.22: Extracción de datos</h3>
<p>Muestra cómo podrías construir una lista de tuplas <code>(nombre, acciones)</code>
donde <code>name</code> y <code>shares</code> se toman de <code>cartera</code>.</p>
<pre><code class="language-python">&gt;&gt;&gt; name_shares =[ (s['name'], s['shares']) for s in portfolio ]
&gt;&gt;&gt; name_shares
[('AA', 100), ('IBM', 50), ('CAT', 150), ('MSFT', 200), ('GE', 95), ('MSFT', 50), ('IBM', 100)]
&gt;&gt;&gt;
</code></pre>
<p>Si cambias los corchetes (<code>[</code>,<code>]</code>) por llaves (<code>{</code>, <code>}</code>), obtienes algo
conocido como comprensión de conjunto. Esto le proporciona valores
únicos o distintos.</p>
<p>Por ejemplo, esto determina el conjunto de nombres de acciones únicos
que aparecen en <code>portafolio</code>:</p>
<pre><code class="language-python">&gt;&gt;&gt; names = { s['name'] for s in portfolio }
&gt;&gt;&gt; names
{ 'AA', 'GE', 'IBM', 'MSFT', 'CAT' }
&gt;&gt;&gt;
</code></pre>
<p>Si especifica pares <code>clave:valor</code>, puede crear un diccionario. Por
ejemplo, crear un diccionario que asigne el nombre de una acción al
número total de acciones que posee.</p>
<pre><code class="language-python">&gt;&gt;&gt; holdings = { name: 0 for name in names }
&gt;&gt;&gt; holdings
{'AA': 0, 'GE': 0, 'IBM': 0, 'MSFT': 0, 'CAT': 0}
&gt;&gt;&gt;
</code></pre>
<p>Esta última característica se conoce como <strong>diccionario por
comprensión</strong>. Vamos a tabular:</p>
<pre><code class="language-python">&gt;&gt;&gt; for s in portfolio:
        holdings[s['name']] += s['shares']

&gt;&gt;&gt; holdings
{ 'AA': 100, 'GE': 95, 'IBM': 150, 'MSFT':250, 'CAT': 150 }
&gt;&gt;&gt;
</code></pre>
<p>Pruebe este ejemplo que filtra el diccionario de <code>prices</code> solo a
aquellos nombres que aparecen en la cartera:</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio_prices = { name: prices[name] for name in names }
&gt;&gt;&gt; portfolio_prices
{'AA': 9.22, 'GE': 13.48, 'IBM': 106.28, 'MSFT': 20.89, 'CAT': 35.46}
&gt;&gt;&gt;
</code></pre>
<h3 id="ejercicio-223-extraccion-de-datos-de-archivos-csv">Ejercicio 2.23: Extracción de datos de archivos CSV</h3>
<p>Saber cómo utilizar diversas combinaciones de listas, conjuntos y
diccionarios puede ser útil en diversas formas de procesamiento de
datos. A continuación se muestra un ejemplo que muestra cómo extraer
columnas seleccionadas de un archivo CSV.</p>
<p>Primero, lea una fila de información de encabezado de un archivo CSV:</p>
<pre><code class="language-python">&gt;&gt;&gt; import csv
&gt;&gt;&gt; f = open('Data/portfoliodate.csv')
&gt;&gt;&gt; rows = csv.reader(f)
&gt;&gt;&gt; headers = next(rows)
&gt;&gt;&gt; headers
['name', 'date', 'time', 'shares', 'price']
&gt;&gt;&gt;
</code></pre>
<p>A continuación, defina una variable que enumere las columnas que
realmente le interesan:</p>
<pre><code class="language-python">&gt;&gt;&gt; select = ['name', 'shares', 'price']
&gt;&gt;&gt;
</code></pre>
<p>Ahora, ubique los índices de las columnas anteriores en el archivo CSV
de origen:</p>
<pre><code class="language-python">&gt;&gt;&gt; indices = [ headers.index(colname) for colname in select ]
&gt;&gt;&gt; indices
[0, 3, 4]
&gt;&gt;&gt;
</code></pre>
<p>Por último, lea una fila de datos y conviértala en un diccionario
utilizando un diccionario por comprensión:</p>
<pre><code class="language-python">&gt;&gt;&gt; row = next(rows)
&gt;&gt;&gt; record = { colname: row[index] for colname, index in zip(select, indices) }   # dict-comprehension
&gt;&gt;&gt; record
{'price': '32.20', 'name': 'AA', 'shares': '100'}
&gt;&gt;&gt;
</code></pre>
<p>Si te sientes cómodo con lo que acaba de pasar, lee el resto del
archivo:</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio = [ { colname: row[index] for colname, index in zip(select, indices) } for row in rows ]
&gt;&gt;&gt; portfolio
[{'price': '91.10', 'name': 'IBM', 'shares': '50'}, {'price': '83.44', 'name': 'CAT', 'shares': '150'},
  {'price': '51.23', 'name': 'MSFT', 'shares': '200'}, {'price': '40.37', 'name': 'GE', 'shares': '95'},
  {'price': '65.10', 'name': 'MSFT', 'shares': '50'}, {'price': '70.44', 'name': 'IBM', 'shares': '100'}]
&gt;&gt;&gt;
</code></pre>
<p>Vaya, acabas de reducir gran parte de la función <code>read_portfolio()</code> a
una sola declaración.</p>
<h2 id="comentario">Comentario</h2>
<p>Las listas por comprensión se utilizan comúnmente en Python como un
medio eficiente para transformar, filtrar o recopilar datos. Debido a la
sintaxis, no conviene exagerar: intenta que cada lista por comprensión
sea lo más simple posible. Está bien dividir las cosas en varios pasos.
Por ejemplo, no está claro que usted quiera soltar ese último ejemplo
ante sus desprevenidos compañeros de trabajo.</p>
<p>Dicho esto, saber cómo manipular datos rápidamente es una habilidad
increíblemente útil. Existen numerosas situaciones en las que podría ser
necesario resolver algún tipo de problema puntual relacionado con la
importación, exportación, extracción de datos, etc. Convertirse en un
maestro de las listas por comprensión puede reducir sustancialmente el
tiempo empleado en idear una solución. Además, no te olvides del módulo
<code>collections</code>.</p>
<p><a href="../../Contents/">Contenido</a> | <a href="../05_Collections/">Anterior (2.5 Módulo
collections)</a> | <a href="../07_Objects/">Próximo (2.7 Modelo de
objetos)</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
