<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Mario R. Melchiori">
        <link rel="canonical" href="https://mrmelchi.github.io/Python_Practico/02_Working_with_data/07_Objects/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>07_Objects - Python Practico</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Python Practico</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="../Contents.Rmd">Contenido</a> | <a href="06_List_comprehension.Rmd">Anterior (2.6 Listas por comprensión)</a> | <a href="../03_Program_organization/00_Overview.Rmd">Siguiente (3. Organización del programa)</a></p>
<h3 id="27-objetos">2.7 Objetos</h3>
<p>Esta sección presenta más detalles sobre el modelo de objetos internos de Python y analiza algunos asuntos relacionados con la administración de memoria, la copia y la verificación de tipos.</p>
<h4 id="asignacion">Asignación</h4>
<p>Muchas operaciones en Python están relacionadas con la <em>asignación</em> o <em>almacenamiento</em> de valores.</p>
<pre><code class="language-python">a = value # Asignación a una variable
s[n] = value # Asignación a una lista
s.append(value) # Anexar a una lista
d['key'] = value # Agregar a un diccionario
</code></pre>
<p><em>Precaución: las operaciones de asignación </em><em>nunca hacen una copia</em><em> del valor que se está asignando.</em> Todas las asignaciones son simplemente copias de referencia (o copias de puntero si lo prefiere).</p>
<h4 id="ejemplo-de-asignacion">Ejemplo de asignación</h4>
<p>Considere este fragmento de código.</p>
<pre><code class="language-python">a = [1,2,3]
b = a
c = [a,b]
</code></pre>
<p>Una imagen de las operaciones de memoria subyacentes. En este ejemplo, solo hay un objeto de lista <code>[1,2,3]</code>, pero hay cuatro referencias diferentes a él.</p>
<p><img alt="Referencias" src="../references.png" /></p>
<p>Esto significa que modificar un valor afecta a <em>todas</em> las referencias.</p>
<pre><code class="language-python">&gt;&gt;&gt; a.append(999)
&gt;&gt;&gt; a
[1,2,3,999]
&gt;&gt;&gt; b
[1,2,3,999]
&gt;&gt;&gt; c
[[1,2,3,999], [1,2,3,999]]
&gt;&gt;&gt;
</code></pre>
<p>Observe cómo un cambio en la lista original aparece en todos lados (¡vaya!). Esto se debe a que nunca se hicieron copias. Todo apunta a lo mismo.</p>
<h4 id="reasignacion-de-valores">Reasignación de valores</h4>
<p>Reasignar un valor <em>nunca</em> sobrescribe la memoria utilizada por el valor anterior.</p>
<pre><code class="language-python">a = [1,2,3]
b = a
a = [4,5,6]

print(a) # [4, 5, 6]
print(b) # [1, 2, 3] Contiene el valor original
</code></pre>
<p>Recuerde: <strong>Las variables son nombres, no ubicaciones de memoria.</strong></p>
<h4 id="algunos-peligros">Algunos peligros</h4>
<p>Si no sabe sobre este intercambio, en algún momento se disparará en el pie. Escenario típico. Modifica algunos datos pensando que son su propia copia privada y accidentalmente corrompe algunos datos en alguna otra parte del programa.</p>
<p><em>Comentario: Esta es una de las razones por las que los tipos de datos primitivos (int, float, string) son inmutables (solo lectura).</em></p>
<h4 id="identidad-y-referencias">Identidad y referencias</h4>
<p>Use el operador <code>is</code> para verificar si dos valores son exactamente el mismo objeto.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [1,2,3]
&gt;&gt;&gt; b = a
&gt;&gt;&gt; a is b
True
&gt;&gt;&gt;
</code></pre>
<p><code>is</code> compara la identidad del objeto (un entero). La identidad se puede obtener usando <code>id()</code>.</p>
<pre><code class="language-python">&gt;&gt;&gt; id(a)
3588944
&gt;&gt;&gt; id(b)
3588944
&gt;&gt;&gt;
</code></pre>
<p>Nota: Casi siempre es mejor usar <code>==</code> para verificar objetos. El comportamiento de <code>is</code> suele ser inesperado:</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [1,2,3]
&gt;&gt;&gt; b = a
&gt;&gt;&gt; c = [1,2,3]
&gt;&gt;&gt; a is b
True
&gt;&gt;&gt; a is c
False
&gt;&gt;&gt; a == c
True
&gt;&gt;&gt;
</code></pre>
<h4 id="copias-superficiales">Copias superficiales</h4>
<p>Las listas y los diccionarios tienen métodos para copiar.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [2,3,[100,101],4]
&gt;&gt;&gt; b = list(a) # Hacer una copia
&gt;&gt;&gt; a is b
False
</code></pre>
<p>Es una lista nueva, pero los elementos de la lista se comparten.</p>
<pre><code class="language-python">&gt;&gt;&gt; a[2].append(102)
&gt;&gt;&gt; b[2]
[100,101,102]
&gt;&gt;&gt;
&gt;&gt;&gt; a[2] is b[2]
True
&gt;&gt;&gt;
</code></pre>
<p>Por ejemplo, se está compartiendo la lista interna <code>[100, 101, 102]</code>. Esto se conoce como copia superficial. Aquí hay una imagen.</p>
<p><img alt="Copia superficial" src="../shallow.png" /></p>
<h4 id="copias-profundas">Copias profundas</h4>
<p>A veces es necesario hacer una copia de un objeto y de todos los objetos que contiene. Puede utilizar el módulo <code>copy</code> para esto:</p>
<pre><code class="language-python">&gt;&gt;&gt; a = [2,3,[100,101],4]
&gt;&gt;&gt; import copy
&gt;&gt;&gt; b = copy.deepcopy(a)
&gt;&gt;&gt; a[2].append(102)
&gt;&gt;&gt; b[2]
[100,101]
&gt;&gt;&gt; a[2] is b[2]
False
&gt;&gt;&gt;
</code></pre>
<h4 id="nombres-valores-tipos">Nombres, valores, tipos</h4>
<p>Los nombres de las variables no tienen un <em>tipo</em>. Son solo un nombre. Sin embargo, los valores <em>sí</em> tienen un tipo subyacente.</p>
<pre><code class="language-python">&gt;&gt;&gt; a = 42
&gt;&gt;&gt; b = 'Hello World'
&gt;&gt;&gt; type(a)
&lt;type 'int'&gt;
&gt;&gt;&gt; type(b)
&lt;type 'str'&gt;
</code></pre>
<p><code>type()</code> le dirá cuál es. El nombre del tipo se utiliza generalmente como una función que crea o convierte un valor a ese tipo.</p>
<h4 id="comprobacion-de-tipos">Comprobación de tipos</h4>
<p>Cómo saber si un objeto es de un tipo específico.</p>
<pre><code class="language-python">if isinstance(a, list):
  print('a is a list')
</code></pre>
<p>Comprobación de uno de los muchos tipos posibles.</p>
<pre><code class="language-python">if isinstance(a, (list,tuple)):
  print('a is a list or tuple')
</code></pre>
<p><em>Precaución: No se exceda con la comprobación de tipos. Puede generar una complejidad excesiva en el código. Por lo general, solo lo haría si al hacerlo evitara errores comunes que cometen otras personas al usar su código.</em></p>
<h4 id="todo-es-un-objeto">Todo es un objeto</h4>
<p>Números, cadenas, listas, funciones, excepciones, clases, instancias, etc. son todos objetos. Esto significa que todos los objetos que se pueden nombrar se pueden pasar como datos, colocar en contenedores, etc., sin ninguna restricción. No hay tipos <em>especiales</em> de objetos. A veces se dice que todos los objetos son "de primera clase".</p>
<p>Un ejemplo simple:</p>
<pre><code class="language-python">&gt;&gt;&gt; import math
&gt;&gt;&gt; items = [abs, math, ValueError ]
&gt;&gt;&gt; items
[&lt;built-in function abs&gt;,
  &lt;module 'math' (builtin)&gt;,
  &lt;type 'exceptions.ValueError'&gt;]
&gt;&gt;&gt; items[0](-45)
45
&gt;&gt;&gt; items[1].sqrt(2)
1.4142135623730951
&gt;&gt;&gt; try:
        x = int('not a number')
    except items[2]:
        print('Falló!')
Falló!
&gt;&gt;&gt;
</code></pre>
<p>Aquí, <code>items</code> es una lista que contiene una función, un módulo y una excepción. Puedes usar directamente los elementos de la lista en lugar de los nombres originales:</p>
<pre><code class="language-python">items[0](-45) # abs
items[1].sqrt(2) # math
except items[2]: # ValueError
</code></pre>
<p>Un gran poder conlleva una responsabilidad. El hecho de que puedas hacer eso no significa que debas hacerlo.</p>
<h4 id="ejercicios">Ejercicios</h4>
<p>En este conjunto de ejercicios, observamos parte del poder que proviene de los objetos de primera clase.</p>
<h5 id="ejercicio-224-datos-de-primera-clase">Ejercicio 2.24: Datos de primera clase</h5>
<p>En el archivo <code>Data/portfolio.csv</code>, leemos datos organizados en columnas que se ven así:</p>
<pre><code class="language-csv">name,shares,price
&quot;AA&quot;,100,32.20
&quot;IBM&quot;,50,91.10
...
</code></pre>
<p>En el código anterior, usamos el módulo <code>csv</code> para leer el archivo, pero aún así tuvimos que realizar conversiones de tipo manuales. Por ejemplo:</p>
<pre><code class="language-python">```python
for row in rows:
    name   = row[0]
    shares = int(row[1])
    price  = float(row[2])
```
</code></pre>
<p>Este tipo de conversión también se puede realizar de una manera más inteligente utilizando algunas operaciones básicas de lista.</p>
<p>Haz una lista de Python que contenga los nombres de las funciones de conversión que usarías para convertir cada columna al tipo apropiado:</p>
<pre><code class="language-python">&gt;&gt;&gt; types = [str, int, float]
&gt;&gt;&gt;
</code></pre>
<p>La razón por la que puedes crear esta lista es que todo en Python es <em>de primera clase</em>. Por lo tanto, si quieres tener una lista de funciones, está bien. Los elementos de la lista que creaste son funciones para convertir un valor <code>x</code> en un tipo determinado (por ejemplo, <code>str(x)</code>, <code>int(x)</code>, <code>float(x)</code>).</p>
<p>Ahora, lee una fila de datos del archivo anterior:</p>
<pre><code class="language-python">&gt;&gt;&gt; import csv
&gt;&gt;&gt; f = open('Data/portfolio.csv')
&gt;&gt;&gt; rows = csv.reader(f)
&gt;&gt;&gt; headers = next(rows)
&gt;&gt;&gt; row = next(rows)
&gt;&gt;&gt; row
['AA', '100', '32.20']
&gt;&gt;&gt;
</code></pre>
<p>Como se señaló, esta fila no es suficiente para realizar los cálculos porque los tipos son incorrectos. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; row[1] * row[2]
Traceback (most recent call last):
File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: can't multiplicar sequence by non-int of type 'str'
&gt;&gt;&gt;
</code></pre>
<p>Sin embargo, tal vez los datos se puedan emparejar con los tipos que especificaste en <code>types</code>. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; types[1]
&lt;type 'int'&gt;
&gt;&gt;&gt; row[1]
'100'
&gt;&gt;&gt;
</code></pre>
<p>Intenta convertir uno de los valores:</p>
<pre><code class="language-python">&gt;&gt;&gt; types[1](row[1]) # Igual que int(row[1])
100
&gt;&gt;&gt;
</code></pre>
<p>Intenta convertir un valor diferente:</p>
<pre><code class="language-python">&gt;&gt;&gt; types[2](row[2]) # Igual que float(row[2])
32.2
&gt;&gt;&gt;
</code></pre>
<p>Intenta el cálculo con valores convertidos:</p>
<pre><code class="language-python">&gt;&gt;&gt; types[1](row[1])*types[2](row[2])
3220.0000000000005
&gt;&gt;&gt;
</code></pre>
<p>Comprime los tipos de columna con los campos y mira el resultado:</p>
<pre><code class="language-python">&gt;&gt;&gt; r = list(zip(types, row))
&gt;&gt;&gt; r
[(&lt;type 'str'&gt;, 'AA'), (&lt;type 'int'&gt;, '100'), (&lt;type 'float'&gt;,'32.20')]
&gt;&gt;&gt;
</code></pre>
<p>Notarás que esto ha emparejado una conversión de tipo con un valor. Por ejemplo, <code>int</code> está emparejado con el valor <code>'100'</code>.</p>
<p>La lista comprimida es útil si quieres realizar conversiones en todos los valores, uno después del otro. Prueba esto:</p>
<pre><code class="language-python">&gt;&gt;&gt; converted = []
&gt;&gt;&gt; for func, val in zip(types, row):
          converted.append(func(val))
...
&gt;&gt;&gt; converted
['AA', 100, 32.2]
&gt;&gt;&gt; converted[1] * converted[2]
3220.0000000000005
&gt;&gt;&gt;
</code></pre>
<p>Asegúrate de entender lo que está sucediendo en el código anterior. En el bucle, la variable <code>func</code> es una de las funciones de conversión de tipo (p. ej., <code>str</code>, <code>int</code>, etc.) y la variable <code>val</code> es uno de los valores como <code>'AA'</code>, <code>'100'</code>. La expresión <code>func(val)</code> convierte un valor (algo así como una conversión de tipo).</p>
<p>El código anterior se puede comprimir en una única lista por comprensión.</p>
<pre><code class="language-python">&gt;&gt;&gt; converted = [func(val) for func, val in zip(types, row)]
&gt;&gt;&gt; converted
['AA', 100, 32.2]
&gt;&gt;&gt;
</code></pre>
<h5 id="ejercicio-225-creacion-de-diccionarios">Ejercicio 2.25: Creación de diccionarios</h5>
<p>¿Recuerdas cómo la función <code>dict()</code> puede crear fácilmente un diccionario si tienes una secuencia de nombres y valores de claves? Hagamos un diccionario a partir de los encabezados de las columnas:</p>
<pre><code class="language-python">&gt;&gt;&gt; headers
['name', 'shares', 'price']
&gt;&gt;&gt; convert
['AA', 100, 32.2]
&gt;&gt;&gt; dict(zip(headers, convert))
{'price': 32.2, 'name': 'AA', 'shares': 100}
&gt;&gt;&gt;
</code></pre>
<p>Por supuesto, si ya tienes experiencia con las listas por comprensión, puedes hacer toda la conversión en un solo paso usando una comprensión de diccionarios:</p>
<pre><code class="language-python">&gt;&gt;&gt; { name: func(val) for name, func, val in zip(headers, types, row) }
{'price': 32.2, 'name': 'AA', 'shares': 100}
&gt;&gt;&gt;
</code></pre>
<h5 id="ejercicio-226-el-panorama-general">Ejercicio 2.26: El panorama general</h5>
<p>Si utiliza las técnicas de este ejercicio, podrá escribir instrucciones que conviertan fácilmente los campos de casi cualquier archivo de datos orientado a columnas en un diccionario de Python.</p>
<p>Solo para ilustrar, supongamos que lees datos de un archivo de datos diferente como este:</p>
<pre><code class="language-python">&gt;&gt;&gt; f = open('Data/dowstocks.csv')
&gt;&gt;&gt; rows = csv.reader(f)
&gt;&gt;&gt; headers = next(rows)
&gt;&gt;&gt; row = next(rows)
&gt;&gt;&gt; headers
['name', 'price', 'date', 'time', 'change', 'open', 'high', 'low', 'volume']
&gt;&gt;&gt; row
['AA', '39.48', '6/11/2007', '9:36am', '-0.18', '39.67', '39.69', '39.45', '181800']
&gt;&gt;&gt;
</code></pre>
<p>Convirtamos los campos usando un truco similar:</p>
<pre><code class="language-python">&gt;&gt;&gt; types = [str, float, str, str, float, float, float, float, int]
&gt;&gt;&gt; converted = [func(val) for func, val in zip(types, row)]
&gt;&gt;&gt; record = dict(zip(headers, converted))
&gt;&gt;&gt; record
{'volume': 181800, 'name': 'AA', 'price': 39.48, 'high': 39.69,
'low': 39.45, 'time': '9:36am', 'date': '6/11/2007', 'open': 39.67,
'change': -0.18}
&gt;&gt;&gt; record['name']
'AA'
&gt;&gt;&gt; record['price']
39.48
&gt;&gt;&gt;
</code></pre>
<p>Bonificación: ¿Cómo modificarías este ejemplo para que sea adicional? ¿Cómo analizar la entrada <code>date</code> en una tupla como <code>(6, 11, 2007)</code>?</p>
<p>Dedica un tiempo a reflexionar sobre lo que has hecho en este ejercicio. Volveremos a tratar estas ideas un poco más adelante.</p>
<p><a href="../Contents.Rmd">Contenido</a> | <a href="06_List_comprehension.Rmd">Anterior (2.6 Listas por comprensión)</a> | <a href="../03_Program_organization/00_Overview.Rmd">Siguiente (3. Organización del programa)</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
