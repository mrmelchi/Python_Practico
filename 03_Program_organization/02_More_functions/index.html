
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Mario R. Melchiori">
      
      
        <link rel="canonical" href="https://mrmelchi.github.io/Python_Practico/03_Program_organization/02_More_functions/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>02_More_functions - Python Practico</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#32-mas-detalles-sobre-las-funciones" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Python Practico" class="md-header__button md-logo" aria-label="Python Practico" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Practico
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              02_More_functions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Python Practico" class="md-nav__button md-logo" aria-label="Python Practico" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Python Practico
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#llamada-a-una-funcion" class="md-nav__link">
    <span class="md-ellipsis">
      Llamada a una función
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argumentos-predeterminados" class="md-nav__link">
    <span class="md-ellipsis">
      Argumentos predeterminados
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefiera-argumentos-de-palabras-clave-para-argumentos-opcionales" class="md-nav__link">
    <span class="md-ellipsis">
      Prefiera argumentos de palabras clave para argumentos opcionales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mejores-practicas-de-diseno" class="md-nav__link">
    <span class="md-ellipsis">
      Mejores prácticas de diseño
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valores-de-retorno" class="md-nav__link">
    <span class="md-ellipsis">
      Valores de retorno
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valores-de-retorno-multiples" class="md-nav__link">
    <span class="md-ellipsis">
      Valores de retorno múltiples
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ambito-de-la-variable" class="md-nav__link">
    <span class="md-ellipsis">
      Ámbito de la variable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-locales" class="md-nav__link">
    <span class="md-ellipsis">
      Variables locales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-globales" class="md-nav__link">
    <span class="md-ellipsis">
      Variables globales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modificacion-de-variables-globales" class="md-nav__link">
    <span class="md-ellipsis">
      Modificación de variables globales
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pase-de-argumentos" class="md-nav__link">
    <span class="md-ellipsis">
      Pase de argumentos
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reasignacion-vs-modificacion" class="md-nav__link">
    <span class="md-ellipsis">
      Reasignación vs. Modificación
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejercicios" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ejercicios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejercicio-33-lectura-de-archivos-csv" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 3.3: Lectura de archivos CSV
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejercicio-34-creacion-de-un-selector-de-columnas" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 3.4: Creación de un selector de columnas
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejercicio-35-realizar-conversion-de-tipos" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 3.5: Realizar conversión de tipos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejercicio-36-trabajar-sin-encabezados" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 3.6: Trabajar sin encabezados
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejercicio-37-elegir-un-delimitador-de-columna-diferente" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 3.7: Elegir un delimitador de columna diferente
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comentario" class="md-nav__link">
    <span class="md-ellipsis">
      Comentario
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="../../Contents/">Contenido</a> | <a href="../01_Script/">Anterior (3.1 Funciones y escritura de scripts)</a> | <a href="../03_Error_checking/">Próximo (3.3 Comprobación de errores)</a></p>
<h1 id="32-mas-detalles-sobre-las-funciones">3.2 Más detalles sobre las funciones</h1>
<p>Aunque las funciones se introdujeron anteriormente, se proporcionaron muy pocos detalles sobre cómo funcionan realmente en un nivel más profundo. Esta sección tiene como objetivo llenar algunos vacíos y analizar cuestiones como las convenciones de llamadas, las reglas de alcance y más.</p>
<h2 id="llamada-a-una-funcion">Llamada a una función</h2>
<p>Considere esta función:</p>
<pre><code class="language-python">def read_prices(filename, debug):
    ...
</code></pre>
<p>Puede llamar a la función con argumentos posicionales:</p>
<pre><code>prices = read_prices('prices.csv', True)
</code></pre>
<p>O puede llamar a la función con argumentos de palabras clave:</p>
<pre><code class="language-python">prices = read_prices(filename='prices.csv', debug=True)
</code></pre>
<h2 id="argumentos-predeterminados">Argumentos predeterminados</h2>
<p>A veces desea que un argumento sea opcional. Si es así, asigne un valor predeterminado en la definición de la función.</p>
<pre><code class="language-python">def read_prices(filename, debug=False):
    ...
</code></pre>
<p>Si se asigna un valor predeterminado, el argumento es opcional en las llamadas a la función.</p>
<pre><code class="language-python">d = read_prices('prices.csv')
e = read_prices('prices.dat', True)
</code></pre>
<p><em>Nota: Los argumentos con valores predeterminados deben aparecer al final de la lista de argumentos (todos los argumentos no opcionales van primero).</em></p>
<h2 id="prefiera-argumentos-de-palabras-clave-para-argumentos-opcionales">Prefiera argumentos de palabras clave para argumentos opcionales</h2>
<p>Compare y contraste estos dos estilos de llamada diferentes:</p>
<pre><code class="language-python">parse_data(data, False, True) # ?????

parse_data(data, ignore_errors=True)
parse_data(data, debug=True)
parse_data(data, debug=True, ignore_errors=True)
</code></pre>
<p>En la mayoría de los casos, los argumentos de palabras clave mejoran la claridad del código, especialmente para los argumentos que sirven como indicadores o que están relacionados con características opcionales.</p>
<h2 id="mejores-practicas-de-diseno">Mejores prácticas de diseño</h2>
<p>Siempre de nombres breves, pero significativos, a los argumentos de las funciones.</p>
<p>Alguien que use una función puede querer usar el estilo de llamada de palabras clave.</p>
<pre><code class="language-python">d = read_prices('prices.csv', debug=True)
</code></pre>
<p>Las herramientas de desarrollo de Python mostrarán los nombres en las funciones de ayuda y la documentación.</p>
<h2 id="valores-de-retorno">Valores de retorno</h2>
<p>La declaración <code>return</code> devuelve un valor</p>
<pre><code class="language-python">def square(x):
    return x * x
</code></pre>
<p>Si no se proporciona ningún valor de retorno o falta <code>return</code>, se devuelve <code>None</code>.</p>
<pre><code class="language-python">def bar(x):
    declaraciones
    return

a = bar(4)      # a = None

# de otro modo

def foo(x):
    declaraciones  # Sin `return`

b = foo(4)      # b = None
</code></pre>
<h2 id="valores-de-retorno-multiples">Valores de retorno múltiples</h2>
<p>Las funciones solo pueden devolver un valor. Sin embargo, una función puede devolver múltiples valores al devolverlos en una tupla.</p>
<pre><code class="language-python">def divide(a,b):
    q = a // b      # Cociente entero
    r = a % b       # Resto
    return q, r     # Devuelve una tupla
</code></pre>
<p>Ejemplo de uso:</p>
<pre><code class="language-python">x, y = divide(37,5)     # x = 7, y = 2

x = divide(37, 5)       # x = (7, 2)
</code></pre>
<h2 id="ambito-de-la-variable">Ámbito de la variable</h2>
<p>Los programas asignan valores a las variables.</p>
<pre><code class="language-python">x = valor       # Variable global

def foo():
    y = valor   # Variable local
</code></pre>
<p>Las asignaciones de variables ocurren fuera y dentro de las definiciones de funciones. Las variables definidas fuera son "globales". Las variables dentro de una función son "locales".</p>
<h2 id="variables-locales">Variables locales</h2>
<p>Las variables asignadas dentro de las funciones son privadas.</p>
<pre><code class="language-python">def read_portfolio(filename):
    portfolio = []
    with open(filename) as file:
        headers = next(file)
        for line in file:
            fields = line.split(',')
            s = (fields[0], int(fields[1]), float(fields[2]))
            portfolio.append(s)
    return portfolio
</code></pre>
<p>En este ejemplo, <code>filename</code>, ´file´, <code>portfolio</code>, <code>line</code>, <code>fields</code> y <code>s</code> son variables locales. Esas variables no se conservan ni se puede acceder a ellas después de la llamada a la función.</p>
<pre><code class="language-python">&gt;&gt;&gt; stocks = read_portfolio('Data/portfolio.csv')
&gt;&gt;&gt; fields
Traceback (most recent call last):
File &quot;&lt;stdin&gt;&quot;, line 1, in ?
NameError: name 'fields' is not defined
&gt;&gt;&gt;
</code></pre>
<p>Las variables locales tampoco pueden entrar en conflicto con las variables que se encuentran en otro lugar.</p>
<h2 id="variables-globales">Variables globales</h2>
<p>Las funciones pueden acceder libremente a los valores de las variables globales definidas en el mismo archivo.</p>
<pre><code class="language-python">name = 'Dave'

def greeting():
    print('Hola', name)  # Uso de la variable global `name`
</code></pre>
<p>Sin embargo, las funciones no pueden modificar las variables globales:</p>
<pre><code class="language-python">name = 'Dave'

def spam():
  name = 'Guido'

spam()
print(name) # imprime 'Dave'
</code></pre>
<p><strong>Recuerde: todas las asignaciones en funciones son locales.</strong></p>
<h2 id="modificacion-de-variables-globales">Modificación de variables globales</h2>
<p>Si debe modificar una variable global, debe declararla como tal.</p>
<pre><code class="language-python">name = 'Dave'

def spam():
    global name
    name = 'Guido' # Cambia el nombre global anterior
</code></pre>
<p>La declaración global debe aparecer antes de su uso y la variable correspondiente debe existir en el mismo archivo que la función. Habiendo visto esto, debes saber que se considera una mala forma de hacerlo. De hecho, intenta evitar el uso de "global" por completo si puedes. Si necesitas una función para modificar algún tipo de estado fuera de la función, es mejor usar una clase en su lugar (más sobre esto más adelante).</p>
<h2 id="pase-de-argumentos">Pase de argumentos</h2>
<p>Cuando llamas a una función, las variables de argumento son nombres que hacen referencia a los valores pasados. Estos valores NO son copias (ver <a href="../../02_Working_with_data/07_Objects/">sección 2.7</a>). Si se pasan tipos de datos mutables (por ejemplo, listas, diccionarios), se pueden modificar <em>in situ</em>.</p>
<pre><code class="language-python">def foo(items):
    items.append(42)    # Modifies the input object

a = [1, 2, 3]
foo(a)
print(a)           # [1, 2, 3, 42]
</code></pre>
<p><strong>Punto clave: Las funciones no reciben una copia de los argumentos de entrada.</strong></p>
<h2 id="reasignacion-vs-modificacion">Reasignación vs. Modificación</h2>
<p>Asegúrese de comprender la sutil diferencia entre modificar un valor y reasignar un nombre de variable.</p>
<pre><code class="language-python">def foo(items):
    items.append(42) # Modifica el objeto de entrada

a = [1, 2, 3]
foo(a)
print(a) # [1, 2, 3, 42]

# en lugar de

def bar(items):
    items = [4,5,6] # Reasigna la variable `items` local para que apunte a un objeto diferente

b = [1, 2, 3]
bar(b)
print(b) # [1, 2, 3]
</code></pre>
<p><em>Recordatorio: la asignación de variables nunca sobrescribe la memoria. El nombre simplemente está ligado a un nuevo valor.</em></p>
<h2 id="ejercicios">Ejercicios</h2>
<p>Este conjunto de ejercicios te permite implementar lo que es, quizás, la parte más poderosa y difícil del curso. Hay muchos pasos y muchos conceptos de ejercicios anteriores se combinan a la vez. La solución final consta de tan solo unas 25 líneas de código, pero tómate tu tiempo y asegúrate de comprender cada parte.</p>
<p>Una parte central de tu programa <code>report.py</code> se centra en la lectura de archivos CSV. Por ejemplo, la función <code>read_portfolio()</code> lee un archivo que contiene filas de datos de cartera y la función <code>read_prices()</code> lee un archivo que contiene filas de datos de precios. En ambas funciones, hay muchos fragmentos "complicados" de bajo nivel y características similares. Por ejemplo, ambas abren un archivo y lo envuelven con el módulo <code>csv</code> y ambas convierten varios campos en nuevos tipos.</p>
<p>Si estuvieras haciendo mucho análisis de archivos de verdad, probablemente querrías limpiar algo de esto y hacerlo más general. Ese es nuestro objetivo.</p>
<p>Comienza este ejercicio abriendo el archivo llamado <code>Work/fileparse.py</code>. Aquí es donde haremos nuestro trabajo.</p>
<h3 id="ejercicio-33-lectura-de-archivos-csv">Ejercicio 3.3: Lectura de archivos CSV</h3>
<p>Para comenzar, centrémonos en el problema de leer un archivo CSV en una lista de diccionarios. En el archivo <code>fileparse.py</code>, defina una función que se parezca a esto:</p>
<pre><code class="language-python"># fileparse.py
import csv

def parse_csv(filename):
    '''
    Analiza un archivo CSV en una lista de registros
    '''
    with open(filename) as f:
        rows = csv.reader(f)

        # Read the file headers
        headers = next(rows)
        records = []
        for row in rows:
            if not row:    # Omite filas sin datos
                continue
            record = dict(zip(headers, row))
            records.append(record)

    return records
</code></pre>
<p>Esta función lee un archivo CSV y crea una lista de diccionarios mientras oculta los detalles de apertura del archivo, lo envuelve con el módulo <code>csv</code>, ignora las líneas en blanco, etc.</p>
<p>Pruébelo:</p>
<p>Sugerencia: <code>python -i fileparse.py</code>.</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio = parse_csv('Data/portfolio.csv')
&gt;&gt;&gt; portfolio
[{'name': 'AA', 'shares': '100', 'price': '32.20'}, {'name': 'IBM', 'shares': '50', 'price': '91.10'}, {'name': 'CAT', 'shares': '150', 'price': '83.44'}, {'name': 'MSFT', 'shares': '200', 'price': '51.23'}, {'name': 'GE', 'shares': '95', 'price': '40.37'}, {'name': 'MSFT', 'shares': '50', 'price': '65.10'}, {'name': 'IBM', 'shares': '100', 'price': '70.44'}]
&gt;&gt;&gt;
</code></pre>
<p>Esto es bueno, excepto que no se puede hacer ningún tipo de cálculo útil con los datos porque todo se representa como una cadena. Arreglaremos esto en breve, pero sigamos trabajando en ello.</p>
<h3 id="ejercicio-34-creacion-de-un-selector-de-columnas">Ejercicio 3.4: Creación de un selector de columnas</h3>
<p>En muchos casos, solo interesan las columnas seleccionadas de un archivo CSV, no todos los datos. Modifique la función <code>parse_csv()</code> para que permita opcionalmente seleccionar columnas especificadas por el usuario de la siguiente manera:</p>
<pre><code class="language-python">&gt;&gt;&gt; # Leer todos los datos
&gt;&gt;&gt; portfolio = parse_csv('Data/portfolio.csv')
&gt;&gt;&gt; portfolio
[{'name': 'AA', 'shares': '100', 'price': '32.20'}, {'name': 'IBM', 'shares': '50', 'price': '91.10'}, {'name': 'CAT', 'shares': '150', 'price': '83.44'}, {'name': 'MSFT', 'shares': '200', 'price': '51.23'}, {'name': 'GE', 'shares': '95', 'price': '40.37'}, {'name': 'MSFT', 'shares': '50', 'price': '65.10'}, {'name': 'IBM', 'shares': '100', 'price': '70.44'}]

&gt;&gt;&gt; # Leer solo algunos de los datos
&gt;&gt;&gt; shares_held = parse_csv('Data/portfolio.csv', select=['name','shares'])
&gt;&gt;&gt; shares_held
[{'name': 'AA', 'shares': '100'}, {'name': 'IBM', 'shares': '50'}, {'name': 'CAT', 'shares': '150'}, {'name': 'MSFT', 'shares': '200'}, {'name': 'GE', 'shares': '95'}, {'name': 'MSFT', 'shares': '50'}, {'name': 'IBM', 'shares': '100'}]
&gt;&gt;&gt;
</code></pre>
<p>En el <a href="../../02_Working_with_data/06_List_comprehension/">Ejercicio 2.23</a> se proporcionó un ejemplo de selector de columnas. Sin embargo, aquí se muestra una forma de hacerlo:</p>
<pre><code class="language-python"># fileparse.py
import csv

def parse_csv(filename, select=None):
    '''
    Analizar un archivo CSV con una lista de registros
    '''
    with open(filename) as f:
        rows = csv.reader(f)

        # Leer los encabezados del archivo
        headers = next(rows)

        # Si se proporcionó un selector de columnas, buscar los índices de las columnas especificadas
        # También se limita el conjunto de encabezados utilizados para los diccionarios resultantes
        if select:
            indices = [headers.index(colname) for colname in select]
            headers = select
        else:
            indices = []

        records = []
        for row in rows:
            if not row:    # Omite filas sin datos
                continue
            # Filtrar la fila si se seleccionaron columnas específicas
            if indices:
                row = [ row[index] for index in indices ]

            # Crear un dicciona
            record = dict(zip(headers, row))
            records.append(record)

    return records
</code></pre>
<p>Esta parte tiene varios puntos complicados. Probablemente, el más importante sea la asignación de las selecciones de columnas a los índices de filas. Por ejemplo, supongamos que el archivo de entrada tiene los siguientes encabezados:</p>
<pre><code class="language-python">&gt;&gt;&gt; headers = ['name', 'date', 'time', 'shares', 'price']
&gt;&gt;&gt;
</code></pre>
<p>Ahora, supongamos que las columnas seleccionadas fueran las siguientes:</p>
<pre><code class="language-python">&gt;&gt;&gt; select = ['name', 'shares']
&gt;&gt;&gt;
</code></pre>
<p>Para realizar la selección adecuada, debe asignar los nombres de las columnas seleccionadas a los índices de las columnas en el archivo. Esto es lo que hace este paso:</p>
<pre><code class="language-python">&gt;&gt;&gt; indices = [headers.index(colname) for colname in select ]
&gt;&gt;&gt; indices
[0, 3]
&gt;&gt;&gt;
</code></pre>
<p>En otras palabras, ´name´ es la columna 0 y ´shares` es la columna 3. Cuando se lee una fila de datos del archivo, se utilizan los índices para filtrarla:</p>
<pre><code class="language-python">&gt;&gt;&gt; row = ['AA', '6/11/2007', '9:50am', '100', '32.20' ]
&gt;&gt;&gt; row = [ row[index] for index in indices ]
&gt;&gt;&gt; row
['AA', '100']
&gt;&gt;&gt;
</code></pre>
<h3 id="ejercicio-35-realizar-conversion-de-tipos">Ejercicio 3.5: Realizar conversión de tipos</h3>
<p>Modifique la función <code>parse_csv()</code> para que permita opcionalmente conversiones de tipo que se aplicarán a los datos devueltos. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; portfolio = parse_csv('Data/portfolio.csv', types=[str, int, float])
&gt;&gt;&gt; portfolio
[{'name': 'AA', 'shares': 100, 'price': 32.2}, {'name': 'IBM', 'shares': 50, 'price': 91.1}, {'name': 'CAT', 'shares': 150, 'price': 83.44}, {'name': 'MSFT', 'shares': 200, 'price': 51.23}, {'name': 'GE', 'shares': 95, 'price': 40.37}, {'name': 'MSFT', 'shares': 50, 'price': 65.1}, {'name': 'IBM', 'shares': 100, 'price': 70.44}]

&gt;&gt;&gt; shares_held = parse_csv('Data/portfolio.csv', select=['name', 'shares'], types=[str, int])
&gt;&gt;&gt; shares_held
[{'name': 'AA', 'shares': 100}, {'name': 'IBM', 'shares': 50}, {'name': 'CAT', 'shares': 150}, {'name': 'MSFT', 'shares': 200}, {'name': 'GE', 'shares': 95}, {'name': 'MSFT', 'shares': 50}, {'name': 'IBM', 'shares': 100}]
&gt;&gt;&gt;
</code></pre>
<p>Ya exploraste esto en <a href="../../02_Working_with_data/07_Objects/">Ejercicio 2.24</a>.</p>
<p>Necesitará insertar el siguiente fragmento de código en su solución:</p>
<pre><code class="language-python">...
if types:
    row = [func(val) for func, val in zip(types, row) ]
...
</code></pre>
<h3 id="ejercicio-36-trabajar-sin-encabezados">Ejercicio 3.6: Trabajar sin encabezados</h3>
<p>Algunos archivos CSV no incluyen ninguna información de encabezado. Por ejemplo, el archivo <code>prices.csv</code> tiene este aspecto:</p>
<pre><code class="language-csv">&quot;AA&quot;,9.22
&quot;AXP&quot;,24.85
&quot;BA&quot;,44.85
&quot;BAC&quot;,11.27
...
</code></pre>
<p>Modifique la función <code>parse_csv()</code> para que pueda trabajar con dichos archivos creando una lista de tuplas en su lugar. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; prices = parse_csv('Data/prices.csv', types=[str,float], has_headers=False)
&gt;&gt;&gt; prices
[('AA', 9.22), ('AXP', 24.85), ('BA', 44.85), ('BAC', 11.27), ('C', 3.72), ('CAT', 35.46), ('CVX', 66.67), ('DD', 28.47), ('DIS', 24.22), ('GE', 13.48), ('GM', 0.75), ('HD', 23.16), ('HPQ', 34.35), ('IBM', 106.28), ('INTC', 15.72), ('JNJ', 55.16), ('JPM', 36.9), ('KFT', 26.11), ('KO', 49.16), ('MCD', 58.99), ('MMM', 57.1), ('MRK', 27.58), ('MSFT', 20.89), ('PFE', 15.19), ('PG', 51.94), ('T', 24.79), ('UTX', 52.61), ('VZ', 29.26), ('WMT', 49.74), ('XOM', 69.35)]
&gt;&gt;&gt;
</code></pre>
<p>Para realizar este cambio, deberá modificar el código de modo que la primera línea de datos <strong>No</strong> se interprete como una línea de encabezado. Además, deberá asegurarse de no crear diccionarios, ya que ya no hay nombres de columnas para usar como claves.</p>
<h3 id="ejercicio-37-elegir-un-delimitador-de-columna-diferente">Ejercicio 3.7: Elegir un delimitador de columna diferente</h3>
<p>Aunque los archivos CSV son bastante comunes, también es posible encontrar un archivo que utilice un separador de columnas diferente, como una tabulación o un espacio. Por ejemplo, el archivo <code>Data/portfolio.dat</code> tiene este aspecto:</p>
<pre><code class="language-csv">name shares price
&quot;AA&quot; 100 32.20
&quot;IBM&quot; 50 91.10
&quot;CAT&quot; 150 83.44
&quot;MSFT&quot; 200 51.23
&quot;GE&quot; 95 40.37
&quot;MSFT&quot; 50 65.10
&quot;IBM&quot; 100 70.44
</code></pre>
<p>La función <code>csv.reader()</code> permite indicar un delimitador de columna diferente de la siguiente manera:</p>
<pre><code class="language-python">rows = csv.reader(f, delimiter=' ')
`` `

Modifique su función `parse_csv()` para que también permita cambiar el delimitador.

Por ejemplo:

```python
&gt;&gt;&gt; portfolio = parse_csv('Data/portfolio.dat', types=[str, int, float], delimiter=' ')
&gt;&gt;&gt; portfolio
[{'name': 'AA', 'shares': 100, 'price': 32.2}, {'name': 'IBM', 'shares': 50, 'price': 91.1}, {'name': 'CAT', 'shares': 150, 'price': 83.44}, {'name': 'MSFT', 'shares': 200, 'price': 51.23}, {'name': 'GE', 'shares': 95, 'price': 40.37}, {'name': 'MSFT', 'shares': 50, 'price': 65.1}, {'name': 'IBM', 'shares': 100, 'price': 70.44}]
&gt;&gt;&gt;
</code></pre>
<h2 id="comentario">Comentario</h2>
<p>Si has llegado hasta aquí, has creado una bonita función de biblioteca que es realmente útil. Puedes usarla para analizar archivos CSV arbitrarios, seleccionar columnas de interés, realizar conversiones de tipos, sin tener que preocuparte demasiado por el funcionamiento interno de los archivos o el módulo <code>csv</code>.</p>
<p><a href="../../Contents/">Contenido</a> | <a href="../01_Script/">Anterior (3.1 Funciones y escritura de scripts)</a> | <a href="../03_Error_checking/">Próximo (3.3 Comprobación de errores)</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>