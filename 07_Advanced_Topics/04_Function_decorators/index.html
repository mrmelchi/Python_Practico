
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Mario R. Melchiori">
      
      
        <link rel="canonical" href="https://mrmelchi.github.io/Python_Practico/07_Advanced_Topics/04_Function_decorators/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>04_Function_decorators - Python Practico</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#74-decoradores-de-funciones" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Python Practico" class="md-header__button md-logo" aria-label="Python Practico" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Practico
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              04_Function_decorators
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Python Practico" class="md-nav__button md-logo" aria-label="Python Practico" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Python Practico
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ejemplo-de-registro" class="md-nav__link">
    <span class="md-ellipsis">
      Ejemplo de registro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observacion" class="md-nav__link">
    <span class="md-ellipsis">
      Observación
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-que-crea-el-registro" class="md-nav__link">
    <span class="md-ellipsis">
      Código que crea el registro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoradores" class="md-nav__link">
    <span class="md-ellipsis">
      Decoradores
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comentario" class="md-nav__link">
    <span class="md-ellipsis">
      Comentario
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejercicios" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ejercicios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ejercicio-710-un-decorador-para-cronometrar" class="md-nav__link">
    <span class="md-ellipsis">
      Ejercicio 7.10: Un decorador para cronometrar
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="../../Contents/">Contenido</a> | <a href="../03_Returning_functions/">Anterior (7.3 Retornando Funciones y clousures)</a> | <a href="../05_Decorated_methods/">Próximo (7.5 Métodos estáticos y de clase)</a></p>
<h1 id="74-decoradores-de-funciones">7.4 Decoradores de funciones</h1>
<p>Esta sección presenta el concepto de decorador. Este es un tema avanzado del que apenas hemos tocado la superficie.</p>
<h2 id="ejemplo-de-registro">Ejemplo de registro</h2>
<p>Considere una función.</p>
<pre><code class="language-python">def add(x, y):
    return x + y
</code></pre>
<p>Ahora, considere la función con algún registro agregado.</p>
<pre><code class="language-python">def add(x, y):
    print('Llamando a add')
    return x + y
</code></pre>
<p>Ahora una segunda función también con algún registro.</p>
<pre><code class="language-python">def sub(x, y):
    print('Llamando a sub')
    return x - y
</code></pre>
<h2 id="observacion">Observación</h2>
<p><em>Observación: Es algo repetitivo.</em></p>
<p>Escribir programas en los que hay mucha replicación de código suele ser muy molesto. Son tediosos de escribir y difíciles de mantener. Especialmente si decides que quieres cambiar su funcionamiento (es decir, un tipo diferente de registro, tal vez).</p>
<h2 id="codigo-que-crea-el-registro">Código que crea el registro</h2>
<p>Quizás puedas crear una función que cree funciones con el registro agregado a ellas. Un contenedor.</p>
<pre><code class="language-python">def logged(func):
    def wrapper(*args, **kwargs):
        print('Llamando a', func.__name__)
        return func(*args, **kwargs)
    return wrapper
</code></pre>
<p>Ahora úsalo.</p>
<pre><code class="language-python">def add(x, y):
    return x + y

logged_add = logged(add)
</code></pre>
<p>¿Qué sucede cuando llamas a la función devuelta por <code>logged</code>?</p>
<pre><code class="language-python">logged_add(3, 4) # Ves que aparece el mensaje de registro
</code></pre>
<p>Este ejemplo ilustra el proceso de creación de una llamada <em>función contenedora</em>.</p>
<p>Una función contenedora es una función que envuelve otra función con algunos bits adicionales de procesamiento, pero que por lo demás funciona exactamente de la misma manera que la función original.</p>
<pre><code class="language-python">&gt;&gt;&gt; logged_add(3, 4)
Llamando a add # Salida adicional. Añadida por la función contenedora
7
&gt;&gt;&gt;
</code></pre>
<p><em>Nota: La función <code>logged()</code> crea la función contenedora y la devuelve como resultado.</em></p>
<h2 id="decoradores">Decoradores</h2>
<p>Poner envoltorios a las funciones es extremadamente común en Python. Es tan común que existe una sintaxis especial para ello.</p>
<pre><code class="language-python">def add(x, y):
    return x + y

add = logged(add)

# Sintaxis especial
@logged
def add(x, y):
    return x + y
</code></pre>
<p>La sintaxis especial realiza exactamente los mismos pasos que se muestran arriba. Un decorador es simplemente una sintaxis nueva. Se dice que <em>decora</em> la función.</p>
<h2 id="comentario">Comentario</h2>
<p>Hay muchos más detalles sutiles sobre los decoradores que los que se han presentado aquí. Por ejemplo, su uso en clases o el uso de múltiples decoradores con una función. Sin embargo, el ejemplo anterior es una buena ilustración de cómo tiende a surgir su uso. Por lo general, es en respuesta a un código repetitivo que aparece en una amplia gama de definiciones de funciones. Un decorador puede mover ese código a una definición central.</p>
<h2 id="ejercicios">Ejercicios</h2>
<h3 id="ejercicio-710-un-decorador-para-cronometrar">Ejercicio 7.10: Un decorador para cronometrar</h3>
<p>Si define una función, su nombre y módulo se almacenan en los atributos <code>__name__</code> y <code>__module__</code>. Por ejemplo:</p>
<pre><code class="language-python">&gt;&gt;&gt; def add(x,y):
        return x+y

&gt;&gt;&gt; add.__name__
'add'
&gt;&gt;&gt; add.__module__
'__main__'
&gt;&gt;&gt;
</code></pre>
<p>En un archivo <code>timethis.py</code>, escriba una función decoradora <code>timethis(func)</code> que envuelva una función con una capa adicional de lógica que muestre cuánto tiempo tarda una función en ejecutarse. Para ello, rodearás la función con llamadas de temporización como esta:</p>
<pre><code class="language-python">start = time.time()
r = func(*args,**kwargs)
end = time.time()
print('%s.%s: %f' % (func.__module__, func.__name__, end-start))
</code></pre>
<p>A continuación, se incluye un ejemplo de cómo debería funcionar tu decorador:</p>
<pre><code class="language-python">&gt;&gt;&gt; from timethis import timethis
&gt;&gt;&gt; @timethis
    def countdown(n):
        while n &gt; 0:
            n -= 1

&gt;&gt;&gt; countdown(10000000)
__main__.countdown : 0.076562
&gt;&gt;&gt;
</code></pre>
<p>Discusión: Este decorador <code>@timethis</code> se puede colocar delante de cualquier definición de función. Por lo tanto, puedes usarlo como una herramienta de diagnóstico para ajustar el rendimiento.</p>
<p><a href="../../Contents/">Contenido</a> | <a href="../03_Returning_functions/">Anterior (7.3 Retornando Funciones y clousures)</a> | <a href="../05_Decorated_methods/">Próximo (7.5 Métodos estáticos y de clase)</a></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>